# 테스트 및 검증 — 상위 태스크 10

## 상위 태스크 개요
- **설명:** 전체 시스템의 품질 보증, 테스트, 검증 및 최적화
- **모듈/영역:** `tests/`, 전체 시스템
- **관련 기술:** Jest, 통합 테스트, E2E 테스트
- **선행 조건:** Reporter 구현 완료 (상위 태스크 9)
- **참고:** AI_Agent_Project_Plan.md (Section 9 - 품질 및 검증 계획)

---

## 하위 태스크 목록

### 10.1 테스트 환경 설정
- **목적:** 테스트 프레임워크 및 환경 구축
- **작업 내용:**
  - Jest 설치 및 설정
  - TypeScript 테스트 환경 구성
  - 테스트 커버리지 도구 설정
- **설정 파일:**
  ```javascript
  // jest.config.js
  module.exports = {
    preset: 'ts-jest',
    testEnvironment: 'node',
    testMatch: ['**/*.test.ts'],
    collectCoverageFrom: ['src/**/*.ts'],
    coverageThreshold: {
      global: {
        branches: 70,
        functions: 70,
        lines: 70,
        statements: 70
      }
    }
  };
  ```
- **산출물:** `jest.config.js`, `package.json` 스크립트
- **테스트 포인트:**
  - `npm test` 실행 성공

### 10.2 단위 테스트 작성 (유틸리티 함수)
- **목적:** 핵심 유틸리티 함수의 정확성 검증
- **작업 내용:**
  - 텍스트 정규화 함수 테스트
  - 파일명 생성 함수 테스트
  - 비용 계산 함수 테스트
- **테스트 예시:**
  ```typescript
  // src/utils/normalize.test.ts
  describe('normalizeText', () => {
    test('연속 공백을 단일 공백으로 변환', () => {
      const input = 'Hello    World';
      const output = normalizeText(input);
      expect(output).toBe('Hello World');
    });

    test('줄바꿈 3개 이상을 2개로 축소', () => {
      const input = 'Line1\n\n\n\nLine2';
      const output = normalizeText(input);
      expect(output).toBe('Line1\n\nLine2');
    });
  });
  ```
- **테스트 포인트:**
  - 모든 단위 테스트 통과
  - 엣지 케이스 처리 확인

### 10.3 모듈별 통합 테스트
- **목적:** 각 모듈의 전체 기능 검증
- **작업 내용:**
  - PDF Extractor 통합 테스트 (샘플 PDF 사용)
  - OCR Engine 통합 테스트 (샘플 이미지 사용)
  - Preprocessor 통합 테스트
  - LLM Planner/TaskWriter 통합 테스트 (모의 응답 또는 실제 API)
  - FileSplitter 통합 테스트
- **테스트 예시:**
  ```typescript
  // tests/integration/pdf-extractor.test.ts
  describe('PDFExtractor Integration', () => {
    test('샘플 PDF에서 텍스트 추출 성공', async () => {
      const extractor = new PDFExtractor();
      const result = await extractor.extract('./tests/fixtures/sample.pdf');

      expect(result.metadata.totalPages).toBeGreaterThan(0);
      expect(result.pages).toHaveLength(result.metadata.totalPages);
    });
  });
  ```
- **테스트 데이터:**
  - `tests/fixtures/` 디렉토리에 샘플 PDF, 이미지 저장
- **테스트 포인트:**
  - 모든 모듈 통합 테스트 통과

### 10.4 E2E (End-to-End) 테스트
- **목적:** 전체 워크플로우 검증
- **작업 내용:**
  - 실제 PDF 기획서 파일로 CLI 실행
  - 생성된 Markdown 파일 검증
  - 리포트 내용 검증
- **테스트 시나리오:**
  1. CLI 명령어 실행: `pdf2tasks analyze ./tests/fixtures/spec.pdf --out ./tests/output`
  2. 출력 디렉토리에 Markdown 파일 생성 확인
  3. 파일 개수가 예상과 일치하는지 확인
  4. 각 Markdown 파일의 구조 검증 (헤딩, 섹션 존재)
  5. `report.log`, `report.json` 생성 확인
- **테스트 예시:**
  ```typescript
  // tests/e2e/full-workflow.test.ts
  describe('E2E Full Workflow', () => {
    test('전체 프로세스 성공적으로 완료', async () => {
      const outputDir = './tests/output';
      await runCLI(['analyze', './tests/fixtures/spec.pdf', '--out', outputDir]);

      const files = fs.readdirSync(outputDir);
      expect(files).toContain('report.log');
      expect(files).toContain('report.json');
      expect(files.filter(f => f.endsWith('.md')).length).toBeGreaterThan(0);
    }, 300000);  // 5분 타임아웃
  });
  ```
- **테스트 포인트:**
  - E2E 테스트 통과
  - 처리 시간이 목표(50p 5분) 이내

### 10.5 샘플 기획서 파일럿 테스트
- **목적:** 다양한 유형의 기획서로 시스템 검증
- **작업 내용:**
  - 10개 표준 기획서 샘플 준비 (다양한 UI/Flow)
  - 각 샘플로 전체 프로세스 실행
  - 결과 품질 평가 (리드 개발자 리뷰)
- **샘플 카테고리:**
  - 단순 CRUD 앱
  - 복잡한 다단계 플로우 (예: 전자상거래)
  - 실시간 기능 포함 (예: 채팅)
  - 관리자 대시보드
  - 모바일 앱 백엔드
- **평가 기준:**
  - 태스크 정확도 (≥ 4.0/5.0)
  - 누락 기능 비율 (≤ 10%)
  - 개발자 만족도 (≥ 4.0/5.0)
- **테스트 포인트:**
  - 각 샘플 성공적으로 처리
  - 품질 기준 충족

### 10.6 프롬프트 안정성 테스트
- **목적:** LLM 프롬프트의 재현성 및 안정성 검증
- **작업 내용:**
  - 동일 입력으로 여러 번 실행
  - 결과 일관성 확인
  - 복잡한 플로우 문서로 테스트
- **테스트 시나리오:**
  - 동일 PDF로 3회 실행 → 결과 비교
  - LLM 온도(temperature) 설정 조정 테스트
- **평가 기준:**
  - 결과의 70% 이상이 일관성 유지
- **테스트 포인트:**
  - 프롬프트 안정성 확인

### 10.7 성능 및 리소스 최적화
- **목적:** 처리 속도 및 메모리 사용량 최적화
- **작업 내용:**
  - 프로파일링 도구로 병목 지점 식별 (예: Node.js `--prof`)
  - 대용량 PDF (100+ 페이지) 처리 테스트
  - 메모리 누수 확인
  - 병렬 처리 최적화 (OCR, LLM 호출)
- **성능 목표:**
  - 50페이지 PDF: 5분 이내
  - 100페이지 PDF: 10분 이내
  - 메모리 사용량: 2GB 이하
- **최적화 전략:**
  - OCR Worker Pool 크기 조정
  - LLM 호출 배치 처리
  - 불필요한 데이터 조기 해제
- **테스트 포인트:**
  - 성능 목표 달성
  - 메모리 누수 없음

### 10.8 에러 시나리오 테스트
- **목적:** 예외 상황 처리 검증
- **작업 내용:**
  - 손상된 PDF 파일 처리
  - OCR 실패 케이스 처리
  - LLM API 오류 처리 (네트워크 오류, 타임아웃 등)
  - 디스크 공간 부족 시나리오
- **테스트 시나리오:**
  - 암호화된 PDF 입력
  - OCR 신뢰도 매우 낮은 이미지
  - LLM API 키 잘못된 경우
  - 출력 디렉토리 권한 없는 경우
- **테스트 포인트:**
  - 모든 에러 시나리오에서 적절한 에러 메시지 출력
  - 프로세스가 중단되지 않거나 적절히 종료

### 10.9 Claude Code 호환성 검증
- **목적:** 생성된 Markdown 파일이 Claude Code에서 인식 가능한지 확인
- **작업 내용:**
  - 생성된 Markdown을 Claude Code에 입력
  - Claude Code가 태스크를 정확히 이해하는지 테스트
  - 하위 태스크 실행 가능성 확인
- **테스트 방법:**
  - 생성된 Markdown 파일을 Claude Code에 제공
  - "이 태스크를 구현하세요" 요청
  - Claude Code의 응답 품질 평가
- **평가 기준:**
  - Claude Code가 태스크를 이해하고 구현 시작 가능
- **테스트 포인트:**
  - Claude Code 호환성 확인

### 10.10 문서화 및 최종 검토
- **목적:** 프로젝트 문서화 및 코드 품질 최종 점검
- **작업 내용:**
  - README.md 작성 (설치, 사용법, 예시)
  - API 문서 생성 (TypeDoc 또는 JSDoc)
  - 코드 주석 보완
  - 최종 코드 리뷰
- **README.md 포함 내용:**
  - 프로젝트 개요
  - 설치 방법
  - 사용 예시
  - CLI 옵션 설명
  - 트러블슈팅 가이드
- **산출물:** `README.md`, `docs/`
- **테스트 포인트:**
  - README 따라 설치 및 실행 가능
  - 문서 내용 정확성 확인

---

## 완료 조건
- [ ] 테스트 환경 설정 완료 (Jest 등)
- [ ] 단위 테스트 작성 및 통과
- [ ] 모듈별 통합 테스트 통과
- [ ] E2E 테스트 통과
- [ ] 10개 샘플 기획서 파일럿 테스트 완료
- [ ] 프롬프트 안정성 테스트 통과
- [ ] 성능 및 리소스 최적화 완료 (목표 달성)
- [ ] 에러 시나리오 테스트 통과
- [ ] Claude Code 호환성 검증 완료
- [ ] README.md 및 문서화 완료
- [ ] 최종 코드 리뷰 및 품질 점검 완료
